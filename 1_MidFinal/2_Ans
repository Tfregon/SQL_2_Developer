--EXERCISE 02 Q1
CREATE OR REPLACE FUNCTION empSalesPerson(P_CUSTID IN NUMBER) RETURN VARCHAR2
IS

V_LASTNAME EMPLOYEE.LAST_NAME%TYPE;

BEGIN
    SELECT E.LAST_NAME INTO V_LASTNAME 
    FROM EMPLOYEE E
    JOIN CUSTOMER C ON E.EMPLOYEE_ID = C.SALESPERSON_ID
    WHERE C.CUSTOMER_ID = P_CUSTID;
    
    RETURN V_LASTNAME;
    
EXCEPTION 
    WHEN NO_DATA_FOUND THEN
        RETURN NULL;
END;

SELECT STATUS FROM USER_OBJECTS
WHERE OBJECT_NAME = UPPER('empSalesPerson')

SET SERVEROUTPUT ON 
SET VERIFY OFF
ACCEPT S_CUSTID PROMPT 'ENTER THE CUSTOMER ID: '
DECLARE
V_CUSTOMERID CUSTOMER.CUSTOMER_ID%TYPE;
V_LASTNAME EMPLOYEE.LAST_NAME%TYPE;

BEGIN 
    V_CUSTOMERID := '&S_CUSTID';
    V_LASTNAME:= empSalesPerson(V_CUSTOMERID);
    IF V_LASTNAME IS NOT NULL THEN
        DBMS_OUTPUT.PUT_LINE('THE LAST NAME THAT CORRESPONDS TO THE CUSTOMER ID: '||V_CUSTOMERID||' IS: '||V_LASTNAME);
    ELSE
        DBMS_OUTPUT.PUT_LINE('THE INFORMATION THAT CORRESPOND TO THE ID: '||V_CUSTOMERID|| ' DOES NOT EXIST');
    END IF;
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('ERROR : WRONG DATA ENTRY NUMBER');
END;
      
